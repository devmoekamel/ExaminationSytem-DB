-- Department Table
CREATE TABLE Department (
    dept_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

-- Course Table
CREATE TABLE Course (
    course_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    duration INT NOT NULL,
    dept_id INT NOT NULL,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);

-- Student Table
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    year INT NOT NULL,
    dept_id INT NOT NULL,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);

-- Student_Course Table (for M:N relationship between Student and Course)
CREATE TABLE Student_Course (
    student_id INT,
    course_id INT,
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES Student(student_id),
    FOREIGN KEY (course_id) REFERENCES Course(course_id)
);

-- Exam Table
CREATE TABLE Exam (
    exam_id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    date DATE NOT NULL,
    duration INT NOT NULL,
    course_id INT NOT NULL,
    FOREIGN KEY (course_id) REFERENCES Course(course_id)
);

-- Question Type Table
CREATE TABLE QuestionType (
    type_id INT PRIMARY KEY,
    name VARCHAR(50) NOT NULL
);

-- Question Table
CREATE TABLE Question (
    question_id INT PRIMARY KEY,
    text TEXT NOT NULL,
    type_id INT NOT NULL,
    exam_id INT NOT NULL,
    FOREIGN KEY (type_id) REFERENCES QuestionType(type_id),
    FOREIGN KEY (exam_id) REFERENCES Exam(exam_id)
);

-- Choice Table
CREATE TABLE Choice (
    choice_id INT PRIMARY KEY,
    text VARCHAR(255) NOT NULL,
    question_id INT NOT NULL,
    is_correct BIT NOT NULL DEFAULT 0,
    FOREIGN KEY (question_id) REFERENCES Question(question_id)
);

-- Student_Exam Table (for M:N relationship between Student and Exam)
CREATE TABLE Student_Exam (
    student_id INT,
    exam_id INT,
    grade DECIMAL(5,2),
    PRIMARY KEY (student_id, exam_id),
    FOREIGN KEY (student_id) REFERENCES Student(student_id),
    FOREIGN KEY (exam_id) REFERENCES Exam(exam_id)
);

-- Student_Answer Table
CREATE TABLE Student_Answer (
    student_id INT,
    question_id INT,
    answer_text TEXT,
    selected_choice_id INT NULL,
    PRIMARY KEY (student_id, question_id),
    FOREIGN KEY (student_id) REFERENCES Student(student_id),
    FOREIGN KEY (question_id) REFERENCES Question(question_id),
    FOREIGN KEY (selected_choice_id) REFERENCES Choice(choice_id)
);